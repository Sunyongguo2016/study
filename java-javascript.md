
# 全端web开发：使用javascript和java


> notetime: 20180708 sunyongguo
> 出版：2015年8月首版
> javascript和java这两大生态系统之间如何协同，成为所有web开发人员共同面临的问题，本书应运而生，全面又简练地为读者展示了最新的B/S应用开发范式。
> 这是一本写给java程序员的完整版的最新的B/S应用开发范式的指南


>> O'Reilly Media 介绍： 通过图书，杂志，在线服务，调查研究和会议等方式传播创新知识。公司一如既往地通过多种形式缔结信息与人的纽带。
   O’Reilly的会议和峰会集聚了众多超级极客和高瞻远瞩的商业领袖，共同描绘出开创新产业的革命性思想，是技术人士获取信息的一种很好的选择。
   信息是激发创新的力量。


>note:
>> 本书目测对程序员没有什么实质性的提升，可以当作一部技术杂志读，提升一点视野,了解一点自己不知道的小工具，自己note摘要如下
>> **数据库迁移框架(http://flywaydb.org)   前端代码IDE:webStorm（http://www.bit.ly/jb-webstorm）  * google trends(http://www.google.com/trends)
   * stackoverflow 标签(http://stackoverflow.com/tags)
   * github trending (http://github.com/trending)
   * BuiltWith (http://builtwith.com) 使用Selenium模拟各种浏览器测试 
  **   
>>客户端--服务端架构  第九章jQuery与jython 第十二章容器技术


### 前言
   本书的目的是帮助读者在项目中采用合适的技术拼接融合，避免音不相容的技术造成陷阱，或者对给出的决定形成错误的预期。阅读此书可以从宏观上掌握各种技术是如何融合在一起的，对技术的融合有自己的把握，头脑对技术有清晰的理解和应用场景。

### 第一章 因变而变

#### 1.1 web用户
      web用户变了，更追求体验，高性能，交互，技术方式变了，硬件性能提升了--促使开发者采用客户端--服务器端的架构。
      纽约时报最近报道了web用户对网站响应的时间忍耐度（http://www.nytimes.com/2012/03/01/technology/impatient-web-users-flee-slow-loading-sites.html?pagewanted=all&_r=0），如果比对手慢250ms,访问量就会下降很多。

#### 1.2 技术
      目前最新模式使用REST式风格通信的客户端--服务端架构。

#### 1.3 软件开发
      软件开发由繁到简，现在创建一个web应用很简洁，不需要复杂xml；

#### 1.4 哪些没变
      web的本质没有变，还是基于http进行消息传递的客户端--服务器端架构。
      理解：新技术并没有改变一切。高级编程语言（Python等弱类型语言）并没有抹去了解操作系统的需要；对象-关系映射框架也没有抹去了解关系型数据库和SQL的需要。同样的，在开发Web应用时，人们一直试图效仿桌面应用，想忽略Web底层架构。
##### 1.4.1 web的本质
      web本质是由服务器和客户端构成，通过http协议，服务器向客户端提供HTML文档。 * 客户端--服务端的web应用架构更贴合web本身的架构，REST是基于http开发的，客户端--服务器端通过（REST请求，REST响应）构建良好的web应用；
##### 1.4.2 服务器驱动的web开发是有害的
      很多情况下服务器驱动、基于组件的web开发方式都应被客户端--服务器端的架构替换。
#### 1.5 客户端--服务器端的web应用优势
      * 代码组织结构/软件架构 ：有了清晰的组件，我们才能更好的重用代码。至少，同一份RESTful API可供不同的浏览器和移动设备使用。        
      * 设计的灵活性和使用开源api 
      * 原型：原型比冗长的文字，大量的图片，更清晰有效的和客户沟通，纠正想法的错误和不一致。正确使用可节省时间金钱，产生一个好的产品
      * 开发者的效率： 除了可以分别（或同时）搭建客户端和服务器端的原型，工作也能清晰的拆分，进而并行开发。 解耦。
      * 应用性能： ajax体验更流畅，整个页面响应更快，从整体上简化了系统架构。
      创建客户端-服务器端的应用有一些不可避免的挑战。 首先要把JavaScript看作头等开发语言，需要深入学习该语言，使用类库。越过初期学习曲线，使用客户端--服务器端的模式搭建web应用变得异常高效和稳定。

#### 1.6 小结
      新的挑战带来新的机遇。客户端--服务器端的架构设计师对web和web开发变化做出的理所应当的响应。它清楚什么没有改变，因而能够知道人们开发出稳定，持久的解决方案，为后续的增强打好了基础。

###  第二章 JavaScript和JavaScript工具
      核心JavaScript语言需要结合两个不同的API来理解：浏览器对象模型（BOM）和文档对象模型（DOM），尽量全面理解这些API，才能有效地在Web浏览器里进行JavaScript开发。

#### 2.1 学习JavaScript
      JavaScript经典书籍：
      JavaScript： The Good Parts ,道格拉斯*克罗克福著，帮助许多JavaScript开发者形成自己的思想。
      Secrets of JavaScript Ninja ,John Resig 是jQuery之父，由他编写
      另外有一些类似标准语言的参考手册，比前两本书全面，但是不一定要通读；
      JavaScript：The Definitive Guide
      Professional Javascript for Web Devolopment
#### 2.2 JavaScript 历史
#### 2.3 一门函数式语言
      java开发者倾向于站在面向对象的角度解决问题，尽管JavaScript也支持面向对象，但是这却不是解决问题最高效的方式。
      使用JavaScript的函数式编程能力会更高效。理解了什么是函数式编程和它的含义，就弄清了这门语言的本质和能力。
      这里的函数式编程语言是指既支持函数式编程，又支持将函数当做一级对象。

##### 2.3.1 作用域
      JavaScript的作用域概念让人难以捉摸，JavaScript没有区块级作用域，但是有函数级作用域。像if这样的语句这样的区块结构不会产生新的作用域。
      * 函数式编程可能是将来java程序员需要理解的一个重点和发展点
      * JavaScript中，null,undefined和其他一些值被当做false； 如果x是数字或字符串，if(!x),和其他语言一样，返回false
      * 使用var关键字定义局部变量，没有使用该关键字定义的变量为全局变量，使用var关键字定义的局部变量的作用域和函数的作用域相关。
      * 创建一个函数后将其赋值给变量y, 这对java程序员来说有些奇怪，因为java方法只和类或对象的实例关联，该语法展现了JavaScript函数式语言的本质。

##### 2.3.2 一级函数
      函数式JavaScript的基本单元，是名副其实的一级对象，函数可以当作一个变量使用，可当作参数传递；

##### 2.3.3 函数声明和表达式
   1. 函数声明方式：
    * function（）{}
    * function myFunctionName(){}
    * var x = function(){}
    * var r = functoin v(){}
   2. 函数声明在对象内部时，当作对象方法
   3. a函数内定义b函数，返回b函数，此时就形成了闭包，返回的对象就包括b函数本身，也包括创建函数的环境。

##### 2.3.4 函数调用
   有4种方法调用函数：*函数，方法，构造函数，使用call或apply*；

##### 2.3.5 函数参数
   函数有一个特殊变量arguments，它保存了所有传入函数的参数，不管是有名的还是没有名字的。

##### 2.3.6 对象
    JavaScript中的对象和java的对象很不一样，不能混淆，JavaScript中的对象只是一组属性的集合，JavaScript中的对象也有继承，面向对象的设计原则对它也是适用的，但是它和java中的方式大相径庭。

####  2.4 面向java开发者的JavaScript
    讲述了JavaScript和java的区别，语法细节区别； 另：typeof function{} --> function

#### 2.5 最佳开发实践

##### 2.5.1 编码规范与约定
    1.使用HTML定义页面数据结构。
    2.使用css为数据结构增加样式。
    3.使用JavaScript为页面增加交互功能。
       规范可以这么理解，避免在css中使用JavaScript，避免在JavaScript中使用css；避免在HTML中使用JavaScript，避免在JavaScript中使用HTML；

##### 2.5.2 浏览器
    浏览器不仅是一个用户浏览网页的环境，它还是个IDE。集成了调试器，代码格式化工具，分析工具等许多其他工具。（拓展的形式）
##### 2.5.3 集成开发环境
    webStorm（http://www.bit.ly/jb-webstorm）是一款非常优秀的IDE。
##### 2.5.4 单元测试
    书中用到的Jasmine（http://pivotal.github.io/jasmine/）是一个行为驱动开发（BDD，http://www.bit.ly/1dkUNKU）的框架，语法简单，而且没有外部依赖；可以在多浏览器里执行，且每次修改源文件后会执行。
##### 2.5.5 文档

#### 2.6 项目
    JavaScript不同于java，自身有迅速发展的生态系统。

### 第三章 REST和JSON
     REST是一种web服务协议，REST直接依赖底层http协议的功能，人们认为REST是一种简化的协议，缺少实现soap时必须的扩展定义和额外结构。
#### 3.1 什么是REST
##### 3.1.1
    REST使用web地址（url）访问资源，使用动词（http请求）操作资源。
##### 3.1.2 动词（http请求）
    http1.1定义了一组动词（或http请求），根据这些请求，RESTful的方式就是使用GET,POST,PUT,DELETE。http对应的“实体”对象是资源，post/get/put/delete对应crud;
##### 3.1.3 统一资源定位符
#### 3.2 REST约束
    1.客户端-服务器端架构直截了当地划分开了职责，服务器端将很多职责转移到客户端，使自身得到了极大简化。各层之间可以独立开发。
    2.REST要求无状态的设计，会话数据保存在客户端，服务器不维护会话这一点，意味着客户端有了更多的职责，因此会变得复杂（这也是RESTful应用中，JavaScript变得越来越复杂的原因之一。）无状态对多服务器集群部署很方便。
    3.可缓存，REST要求给数据打上标签，标明其是否可被缓存。提高了客户端性能，同时采用合适的缓存失效策略带来了复杂性。
    4.统一接口
    5.分层，每个模块不能越过正在通信的层级访问其他层。
    6.按需交付代码。
#### 3.3 HTTP响应代码
#### 3.4 JSON
    大多数现代浏览器强制使用“同源策略”，因此有jsonp从其他域服务器请求数据，而最近人们开发出了CORS（跨域资源共享）技术，更有活力和安全，CORS使用http头，让来自指定域的服务器提供资源。

#### 3.5 HATEOAS
#### 3.6 API衡量域分类
#### 3.7 函数式编程域REST
#### 3.8 项目
      项目创建了一个最简化的API，能响应GET,POST,UPDATE,DELETE请求，将处理结果返回客户端。还展示了测试REST和其他WEB API时用到的各种工具。
    工具 CURL：（http://curl.haxx.se/）命令行工具，能处理很多通常在浏览器里完成的任务。

### 第4章 java工具

#### 4.1 java语言
#### 4.2 java虚拟机
    java被编译成字节码在jvm上执行，jvm这种方式启发了其他语言，使用VM跨平台运行；
#### 4.3 java工具
    各种IDE工具，插件，方便java开发。
#### 4.4 构建项目
    java可以使用maven灵活方便构建项目。
#### 4.5 处理json的java类库
   gson,jackson;
#### 4.6 项目 
    项目知识都接触过，比较简单。

### 第五章 客户端框架
       
#### 5.1 概述
#### 5.2 起点1.响应式web设计
    响应式web设计力求基于设备的功能，来适应各种显示设备上不同交互方式的用户体验。RWD有三大组件：
    * 流体网络，用于网页上排版网格的适配。利用css相对大小来保证网格及其内容在上下文里的显示保持合适比例。
    * 弹性图片，包括使用css的max-width属性来让图片和其他媒体在其父元素里渲染。
    * css3媒体查询，根据页面渲染环境的物理特征使用特定的先是单位。
       流式布局能等比例缩放，
##### 5.2.1 资源
    *HTML5 Boilerplate,Bootstrap

#### 5.3 起点2.JavaScript库和框架
    JavaScript项目中，最常用的是jQuery，直接进行dom操作。 js框架越来越强大，可以支持可交互性数据以及数据校验等功能；
>  TODO MVC（http://todomvc.com） 提供了流行框架直接直接而详细的比较。

   *流行程度*
   * google trends(http://www.google.com/trends)
   * stackoverflow 标签(http://stackoverflow.com/tags)
   * github trending (http://github.com/trending)
   * BuiltWith (http://builtwith.com)
 许多自己想要解决的问题，网上都有答案，例如网上有jQuery ui和bootstrap融合的（http://github.com/jquery-ui-bootstrap/jquery-ui-bootstrap）; 善于搜索利用网络资源。

#### 5.4 获取起始项目
    许多项目在github有开源地址； trending模块也能找到最火的项目
#### 5.6 项目
    1.以Angular.js为例，学会使用表达式(http://docs-angularjs-org-dev.appspot.com/guide/expression)，测试一个小的表达式输出demo；
    2.举例模型和控制器，（包括控制器和数据绑定）展示效果：
       在Angular中控制器起始就是一个*函数*，用于在指定的*作用域内*实现行为；
    
#### 小结
       JavaScript框架使得开发者不用关心BOM和DOM的实现细节、浏览器兼容性，初始化代码组织等问题和其他挑战。


### 第六章 java WEB API服务器
#### 6.1 更简单的服务器端解决方案
    在新的客户端-服务器端的WEB应用模型里，服务器端的代码被简化了。
#### 6.2 基于java的服务器
    1. java标准版附带了一个http服务器的api，可以用它来创建一个简单，能工作的嵌入式http服务器
    2. jetty嵌入式服务器， jetty本身是eclipse ide一部分，还被用于很多产品中如activeMq,maven,google app engine和Hadoop； 他也可以容易的作为一个组件嵌入到一个定制的java服务器。
    3. netty 嵌入式服务器， jetty是和eclipse基金会相关的，而jboss社区出现了一个某些功能与之重合的项目netty,netty在优化网络应用扩展性上比一般应用要好，netty是一个相对底层，通用的网络类库。

#### 6.3 基于JVM的服务器
#### 6.4 WEB应用服务器
    包含"一组"war包的项目需要打包成ear包，此时就需要一个完整的JEE应用服务器，比如JBoss;

#### 6.5 小结
    本章的例子突出了服务器端开发方式的渐进简化，与之成对应的是客户端代码不断增长的复杂性。 应用服务器的部署需要知道这种替代方案以便更好的适应客户端-服务器端模型。

### 第七章 快速开发实战
#### 1. 开发者的生产力
#### 2. 优化开发者和团队的工作流程
  * 迭代： 短周期的迭代能得到更多的反馈，更多的反馈意味着看到的问题更多，能快速定位问题，循环的周期越短，迭代次数越多，就能获得更多反馈，效果越好。迭代速度几乎优于深入分析。
  * 测试驱动开发，可提高生产效率。  在测试，部署包时，可以增量部署，单元测试，避免全局部署。
  * 测试集成：前端工程师使用Jasmine做单元测试，使用一个插件就可以集成进maven中，而且JavaScript开发者可以使用在自己的工作站上安装Karma,用它来运行客户端代码的单元测试。 使用Selenium可以在各种浏览器上运行功能测试。

#### 3. 生产率和软件开发生命周期
    提高生产效率，需要对任务有准确的分析和*优先级*，就能按照影响生产效率的重要程度优化处理。
   * 管理方式企业文化： 联邦快递案例--激励员工，降低计时工资，提高计件工资。 从根本上改变员工核心利益。胜过道德说教威胁等方法。
   * 技术架构，采用合适的技术，适合项目开发
   * 软件工具，使用IDE方便开发
   * 性能，选择api,数据结构，语言 都会决定性能。 RESTful风格的应用也会提高生产效率
   * 测试，早先的测试很随意，自动化测试也是自动化部署的基础。
   * 底层平台， **数据库迁移框架(http://flywaydb.org)**  可以重新创建数据库，始终明确数据库所处的状态，以确定的方式从当前版本的数据库迁移到较新的版本。

### 第八章 API设计
   1.实用的WEB API 和REST API
   * 在实际应用中webapi配上良好的文档会更加可用。
   * REST在实践中最容易应用的是那一部分？以资源的一致性标识作为名词以及它所遵循的http动词是REST的基础核心。特别是在那些依赖于CRUD操作的应用中尤为明显。

   2.指引
    下面的小节反映了REST在开发轻量级Web服务时所带来的显著影响。它们被推荐为设计简单易懂且可用的Web API的指引。
>  REST解释 ： 名词即资源，动词即http行为，请求参数是修饰符，类似语法一样！！！
   * 名词即资源，动词即http行为；在REST中，指定了资源作为名词，如URL路径以及用于操作的资源的引用。行为即为与功能相对应的操作资源的动词，在RESTful中特指http操作。
   * 请求参数作为修饰符；
   * Web API版本：在url中加一个版本号可以防止API通过干扰客户端的行为对API做出修改。提高了系统的可维护性；
       至于将版本号放在哪个位置，有许多方式： 如放在参数中，放到url中，放到http标头来传递。
   * http标头：头信息可能适用于安全认证和授权，
> Accept和Content type 这两个头信息可以用于影响服务端决定如何用一个请求进行相应以及提供如何的响应，除了能够清楚的区分出xml和json，还可以用于决定jsonp还是json.
   * 安全性：通过HTTPS而不是http来提供api也是一个好主意。
   3.项目
      主要看点： 返回jsonp的调用通常包含一个JavaScript函数名作为制定的查询参数。这些调用返回一样的有JavaScript函数填充的json调用的结果。由于JavaScript文件可以从不同的域下载，
      因此这些内容能够被返回。如果不这样做，他们会被JavaScript的同源策略禁止；
      curl http://localhost:8080/api/greeting/remote?__callback=myCall
      curl http://127.0.0.1:8080/api/greeting/remote?__callback=myCall

### 第九章 jQuery和jython  (**)
#### 服务端：jyphon
    python因其清晰，可读性强，语法规范出名，Python通常比java更轻量级，越来越被作为入门语言；Jython是一个运行在jvm上的Python实现。使得能在安装了java的环境上创建清晰简洁的Python代码。
#### jython web服务器； （**）
#### Mock Api
    在WEB服务端配置及开发的过程中，客户端开发人员可以通过Mock API进行并行开发。
#### 客户端：jQuery
       load事件会在页面全部呈现完成后触发（包括全部资源，如图片）; jQuery也可以提供一个可以更早运行的事件，就是在dom就绪之后。如：$(document).ready(function(){});
       jQuery使用核心：一般模式是使用jQuery查找dom元素并对其加以处理，使用某些类型的模式字符串（css选择器或XPath）来查找DOM元素。处理的方式，可以是简单地读取元素内容，或设计它的内容，
       样式，或通过事件的处理程序联系行为，jQuery同样提供一个一致的ajax处理接口，同样也设计了插件机制来拓展自身。
##### 1.DOM的遍历与操作 **
##### 2.实用函数
       “找到一个元素”然后“做点什么”这种模式非常简答，强大，直观。好用！
        $('div.items').find('.item1').text('HI world').css('background-color','blue');
       
      
### 第十章 JRuby和Angular
    本章项目将展示JRuby和angular如何使用相对较少的代码，对一个包含谷歌财经股市数据的HTML表格进行筛选和排序。

#### 1. 服务器端：JRuby和Sinatra
       使用Ruby和一个名为Sinatra的为框架可以创建简单、动态的网站API。Sinatra实质上就是一个基于Ruby的HTTP包装器。

#### 2. 客户端：AngularJS
       AngularJS读取其相关的HTML结构中的DOM元素，传递自定义的元素和属性（指令），并且将数据绑定到页面对应的模型。

#### 3. 比较jQuery和Angular
       jquery操作dom通常做法：<button id='myButton'>click me</button>   --> $("#myButton").on('click',function(){someFunction();});
       HTML data 属性，html5引入data属性，这类属性专门用于存储数据， 如<li class="pet" data-name="Katniss" data-type="civet">hi kat</li>
#### 4. 项目
       Angular提前使用了一些类似HTML5 web组件的技术，比如模板声明和双向绑定。它们即是可用于当前项目的成熟技术，同时也预示着web开发的未来趋势。

### 第十一章 打包和部署
#### 1. 打包和javaee应用
      java归档（jar）文件用来将java类和资源文件打包成单个归档文件。
      web归档文件（war）.war文件下/web-inf/目录，web.xml文件，定义了web应用的结构和对归档文件中其他资源的引用。常用web容器有tomcat，jetty
      企业归档文件(ear),包含了war，jar和一个application.xml文件，该文件引用了包含的模块，定义了安全角色。为企业级引用而生，必须部署在应用
      服务器中，ear文件不能在web容器里运行，应用服务器有JBoss,IBM的WebShare.Oracle的weblogic Server.
#### 2. javaee应用的部署
      近年来许多分布式远程执行shell命令的项目被开发出来，让这种部署  变得更容易管理；
#### 3. 非Javaee的部署
#### 4. 不同部署方式带来的影响
      部署方式的不同也会影响开发流程和对应基础的选型，最好在开发流程初期就确定好部署目标，以确保所需资源的就位和相关流程的制订。
      Capistrano是一种在多台远程机器上并行执行ssh命令的实用工具。它是基于ruby，并且面向web应用的部署，capistrano的典型应用之一是从SCM系统中
签出web应用，将其部署至多台远程服务器撒花姑娘。Fabric是Python版的Capistrano. 由于云部署环境下服务器的透明性，这些工具常和Puppet, Chef, Ansible和Salt诸如此类的配置管理工具放在一起考虑。


### 第十二章 虚拟化
#### 1.虚拟机的管理
     * DevOpes配置管理，云上虚拟机复杂的配置需要使用chef,或puppet自动化安装和配置虚拟机。类似软件还有Ansible,Salt;这些工具在功能上存在重合，又各有所长。
      DevOps：科技节常见现象，一种工具，技术出现多了就有对应的工作职位，DevOps代表一种职业角色，涵盖传统的开发和运营的工作。开发者个体可能不会深入使用本节介绍的工具，但是了解这些工具有助于和专业DevOps沟通。
#### 2.容器
      操作系统专有的“容器技术”就是一种有限的虚拟化形式。和模拟整个机器不同，容器技术专注于在服务器上虚拟化彼此独立，安全的操作系统进程。
      容器技术举例：
      LXC，在资源利用和安全性之间做出了更好的平衡，相比一个完整的虚拟机，占用更少的资源。
      Docker,扩展了LXC，提供更高级别的API。对于给定容器，其文件系统状态和退出值被保存下来，但是不保存内存状态，容器可以启动，重启，停止。运行的容器基于镜像。
      Docker,用来创建容器的镜像保存于Docker库中，Docker库被注册到一个注册器中，Docker包含了发布和共享镜像的机制。
      --虽然这是一个新项目，但是潜力巨大，它确保能在分布式环境中提供标准的容器。若使用合理，能省去开发者和系统管理员安装机器的时间。
#### 3.项目
      本章项目用到前面提及的多种虚拟化技术。项目需要提前安装Git，virtualBox,和Vagrant.只需要几个步骤就可以设置好Docker（在一个由Vagrant管理的VirtualBox上）。
    使用Vagrant安装Docker方式因操作系统而异，总结起来包括以下步骤。
      1.使用git抓取安装机器所需的包含Vagrantfile的Docker源码；
      2.使用Vagrant安装虚拟机；
      3.用户通过ssh登录新建虚拟机，切换到Docker用户；
      4.Docker就绪后，就可以创建和维护容器了；
   * docker帮助： 可以使用内置的帮助系统学习docker，由于项目变化很快，在线文档可能已经不适用与你当前使用的版本。docker build -help
   * docker镜像和容器的维护： 使用docker工作一段时间后，会积攒下一些镜像和容器。使用info命令给出系统信息报告，其中包括容器和镜像数量； docker info
#### 4.Docker和Vagrant的网络设置
#### 5.小结
      使用现代化的虚拟技术能让客户端--服务器端应用轻松运行于高扩展性的方案之上，而且因其结构化、隔离化的架构。进行分别打包和部署也很容易。

### 第十三章 测试和文档
      软件测试假设全部或部分系统功能按照描述的方式工作。软件测试还能发现如何更好的设计应用，使应用更加模块化，结构化。另外，软件测试还有助于明确需求，用精确的语言描述待测试系统。

