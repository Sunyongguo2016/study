# 大型网站技术架构核心原理与案例分析  
> --阿里“教授” 李智慧
principle of large sites

###  1. 大型网站架构演化
#### 1.2大型网站架构演化发展历程

 >> *本书1.2部分架构的图例很清晰重要*
 
 1. _初始阶段_，  一台服务器，应用程序，文件，数据库都在一起；一个基于所有开源软件的小网站建立；
  2. _用户增加_， 应用服务和数据服务分离  应用程序在一台服务器，需要处理复杂的业务逻辑，所以需要CPU又快又强大； 数据库在一台服务器，需要快速磁盘检索和数据缓存，因此需要更快的硬盘和更大的内存； 文件服务器在另一台服务器，需要存放上传的文件，需要更大的硬盘。
  3. _使用缓存改善网站性能_，  由于用户增多，数据库压力太大导致延迟访问，由此：数据访问遵循2/8法则，所以想到使用缓存。 缓存分2种，一种应用服务器本地缓存，这种受服务器内存限制，且会与应用服务器争内存；另一种是使用远程分布式集群缓
存，部署大内存服务器作为缓存服务器，可以在理论上做到不受内存容量限制的缓存服务；
  4. _使用应用服务器集群改善网站的并发处理能力_， 使用集群是网站解决高并发、海量数据问题的常用手段。 用户过于庞大，不要一味加大服务器内存，性能；应用服务器实现集群是网站可伸缩集群架构设计中较为简单成熟的一种。
    此时通过负载均衡调度服务器，可将来自用户浏览器的访问请求分发到应用服务器集群中任何一台服务器上，压力增大的话在集群中加入更多服务器即可，使应用服务器的负载压力不再成为整个网站的瓶颈。
  5. _数据库读写分离_，  网站使用缓存后，绝大部分数据库操作访问都可以不通过数据库就能完成，但仍有一些写操作或缓存过期，缓存不命中的操作需要访问数据库。用户增大时，数据库又成为网站服务支持的瓶颈。
    大部分数据库提供主从热备功能，因此配置主从数据库关系，可以将一台数据库服务器数据更新到另一台服务器上，利用这个数据库特性实现读写分离。此时，通常在应用服务器端使用专门的数据访问模块，读写数据。
  6. _使用反向代理和cdn加速网站响应_
    国内复杂的网络环境，不同地区用户访问网站速度差别很大。加入网站响应主要有反向代理和CDN加速；2者都是经过负载均衡调度服务器请求的，CDN和反向代理基本原理都是缓存，cdn是从部署在网络提供商的机房服务器取缓存，反向代理从反向代理的服务器取真实应用服务器的缓存。
    使用CDN和反向代理目的都是尽早返回数据给用户，取缓存服务器的数据，一方面加快用户访问速度，另一方面减轻后端服务器的负载压力；
  7. _使用分布式文件系统和分布式数据库系统_。
    任何单一的服务器都满足不了大型网站持续增长的业务需求，数据库读写分离是拆分了2台服务器，随着数据增长，最终需要分布式数据库和分布式文件系统服务器。
    _分布式数据库是网站数据拆分的最后手段_，只有单表数据规模非常庞大才使用，不到不得已，网站更常用数据库拆分手段是业务分库，将不同业务的数据库部署在不同的物理服务器上。
  8. _使用noSql和搜索引擎_
    随着网站业务复杂化，对数据存储和检索需求也越来越复杂，网站需要采用一些非关系型数据库技术如NoSql和非数据库查询技术如搜索引擎。
    者2者都是源自互联网技术手段，对可伸缩的分布式特性具有更好的支持，应用服务器则通过一个统一的数据访问模块访问各种数据，减轻应用程序管理诸多数据源的麻烦。
  9. _业务拆分_    
    大型购物交易网站，会拆分各个业务模块，如商铺，订单，卖家，买家。分归不同的业务团队负责。
  10. _分布式服务_
     通过分布式服务调用共用业务服务（可复用业务连接数据库），来完成具体的业务操作。云计算平台已经作为一种基础资源出售，中小企业不用注重实现细节，直接租用服务即可。

###  2. 大型网站架构模式
_*大型网站架构思路：拆分，从横向纵向拆分，从逻辑上物理上拆分，拆分的粒度很细，在物理上实现微服务集群，远程协同调用工作，降低访问压力*_

>   我们通过学习掌握大型网站架构的一般思路和解决方案，以指导我们的架构设计 

>   为解决大型网站面临的高并发访问，海量数据处理，高可靠运行这些挑战，大型互联网公司提出许多解决方案以实现高性能，高可用，易伸缩可扩展安全等架构目标；

#### 2.1 网站架构模式
   1. 分层  *横向分思想* 各模块分层，例如视图层，业务层，持久层，各模块拆分，人员负责维护自己的模块，保证接口稳定即可；
       分层首先是用在规划软件清晰的逻辑结构便于开发，后来可以将不同层部署到不同服务器上，分层结构对网站支持高并发分布式方向发展至关重要，网站从小就应该分层。
    2. 分割  *纵向分思想*  网站越大，越需要纵向分割，比如在业务层分割，将粒度分割的很细，如购物，论坛，搜索，广告各模块，购物业务比较重还可以细分，如分割机票酒店业务，3C业务，小商品等等细的模块。
       这些模块不管是在逻辑上还是物理部署上，都是独立的。
    3. 分布式  分布式有自身的一些缺陷，如数据一致性，事物等的处理。
   * 常用分布式方案：分布式应用和服务（不同应用复用共同的服务，便于业务功能扩展）；
   * 分布式静态资源（动静分离）；
   * 分布式数据和存储（数据量p级别，一般分布存储，noSql产品一般也是分布式）； 
   * 分布式计算（业务的计算规模很庞大，如数据仓库数据分析统计，网站普遍使用Hadoop及其mapReduce分布式计算框架进行大数据量批处理计算（特点是移动计算而非移动数据，将计算程序分到数据所在位置以加速计算和分布式计算））
   * 此外，还有支持网站线上服务器配置实时更新的分布式配置，分布式环境下实现并发和协同的分布式锁；支持云存储的分布式文件系统等。
  4. 
